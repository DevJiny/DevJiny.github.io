---
title: "Datadog on Kubernetes"
date: 2022-07-14 00:00:00 +0900
categories: [DevOps, K8S, Datadog]
tags: [K8S, Kubernetes, datadog]
render_with_liquid: false
---

## Datadog Document

https://docs.datadoghq.com/containers/kubernetes/installation/?tab=helm&tabs=null

## Basic values <value.yaml>

https://github.com/DataDog/helm-charts/blob/main/examples/datadog/agent_basic_values.yaml

```yaml
targetSystem: "linux"
datadog:
  logs:
    enabled: true
    containerCollectAll: false
    containerCollectUsingFiles: true
  apm:
    portEnabled: true
    socketPath: /var/run/datadog/apm.socket
    hostSocketPath: /var/run/datadog/
  processAgent:
    enabled: true
    processCollection: false
```

## Helm Repo Update

```console
$ helm repo add datadog https://helm.datadoghq.com
$ helm repo update
```

## Helm Install
```console
$ helm install datadog -f values.yaml --set datadog.apiKey=YOURKEY datadog/datadog
```

## Deployment Add SideCar

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    tags.datadoghq.com/env: "<environment>"
    tags.datadoghq.com/service: "<service>"
    tags.datadoghq.com/version: "<version>"
spec:
  template:
    metadata:
      labels:
        tags.datadoghq.com/env: "<environment>"
        tags.datadoghq.com/service: "<service>"
        tags.datadoghq.com/version: "<version>"
    spec:
      initContainers:
        - name: download-agent
          image: busybox
          command:
            - wget
            - -O
            - /agent/dd-java-agent.jar
            - https://dtdg.co/latest-java-tracer
          volumeMounts:
            - name: agent-volume
              mountPath: "/agent"
      volumes:
        # for APM
        - name: apmsocketpath
          hostPath:
            path: /var/run/datadog/
        # for log
        - name: agent-volume
          emptyDir: { }
      containers:
        - name: <CONTAINER_NAME>
          image: <CONTAINER_IMAGE>/<TAG>
          volumeMounts:
            # for APM
            - name: apmsocketpath
              mountPath: /var/run/datadog
            # for log
            - name: agent-volume
              mountPath: "/agent"
          env:
            - name: DD_ENV
              valueFrom:
                fieldRef:
                  fieldPath: metadata.labels['tags.datadoghq.com/env']
            - name: DD_SERVICE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.labels['tags.datadoghq.com/service']
            - name: DD_VERSION
              valueFrom:
                fieldRef:
                  fieldPath: metadata.labels['tags.datadoghq.com/version']
```


























